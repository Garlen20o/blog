import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as n,e as o,o as p}from"./app-Dvgq7Lzg.js";const i={};function r(a,t){return p(),n("div",null,[...t[0]||(t[0]=[o('<h2 id="记录wx小程序打开h5附件pdf下载链接的问题" tabindex="-1"><a class="header-anchor" href="#记录wx小程序打开h5附件pdf下载链接的问题"><span>记录WX小程序打开H5附件pdf下载链接的问题</span></a></h2><p><strong>现象</strong> ：<br> 小程序复用H5，打开下载链接的web-view，内容为一片乱码</p><p><strong>原因：</strong></p><p>在web端，后端接口提供的附件下载链接中，一般配置好了文件响应的Content-type指定了文件的类型。这里点击链接后，分了两种场景。</p><ul><li>浏览打开新标签页，并下载。</li><li>浏览打开新标签页，并在线预览。</li></ul><p>通过查看响应配置可知:</p><p>第一种下载的情况，可以看到</p><p>Content-Type:application/octet-stream</p><p>Content-Disposition: attachment;filename*=UTF-8 &quot;xxx.pdf</p><p>在线预览时：</p><p>Content-Type: application/pdf</p><p>Content-Disposition: inline;filename*=UTF-8 &quot;xxx.pdf</p><p><strong>关于Content-Disposition</strong></p><p>在 HTTP 场景中，第一个参数或者是 <code>inline</code>（默认值，表示回复中的消息体会以页面的一部分或者整个页面的形式展示），或者是 <code>attachment</code>（意味着消息体应该被下载到本地；大多数浏览器会呈现一个“保存为”的对话框，将 <code>filename</code> 的值预填为下载后的文件名，假如它存在的话）。</p><p><strong>总结理解：</strong></p><p>服务器可能没有正确配置以声明资源的正确MIME类型 。</p><p>指定为inline就是网页端预览pdf的，指定为 attachment就是下载到本地</p><p>小程序直接复用后端附件接口时，接口使用了web端常用的---弹出“另存为”对话框 ，其Content-Type:application/octet-stream，Content-Disposition: 指定为attachment，此时小程序控制台警告</p><p><em><u>Resource interpreted as Document but transferred with MIME type application/octet-stream</u></em></p><p>得到是二进制文件的type，小程序不知道怎么解析这个文档。小程序的浏览器是阉割版的，估计没有实现指定为attachment下载。</p><p><strong>解决</strong> :指定为Content-Disposition：inline小程序可以正常预览，满足简单复用H5预览的需求。接口可以增加一个传参，inline，让小程序环境决定是否使用在线预览pdf的方式。</p><p><strong>参考链接：</strong></p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types" target="_blank" rel="noopener noreferrer">MIME</a></p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Disposition" target="_blank" rel="noopener noreferrer">Content-Disposition</a></p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Type" target="_blank" rel="noopener noreferrer">Content-Type</a></p>',25)])])}const c=e(i,[["render",r]]),m=JSON.parse('{"path":"/posts/Content-Disposition.html","title":"浅识Content-Disposition","lang":"zh-CN","frontmatter":{"title":"浅识Content-Disposition","description":"浅识Content-Disposition文件下载响应标头---小程序复用H5预览PDF问题","date":"2024-05-06T00:00:00.000Z","lastUpdated":false,"tags":["Web","微信小程序"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"浅识Content-Disposition\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2024-05-06T00:00:00.000Z\\",\\"dateModified\\":\\"2025-11-01T08:12:15.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Garlen\\",\\"url\\":\\"https://garlen20o.github.io/blog/\\"}]}"],["meta",{"property":"og:url","content":"https://garlen20o.github.io/blog/posts/Content-Disposition.html"}],["meta",{"property":"og:site_name","content":"Garlen"}],["meta",{"property":"og:title","content":"浅识Content-Disposition"}],["meta",{"property":"og:description","content":"浅识Content-Disposition文件下载响应标头---小程序复用H5预览PDF问题"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-11-01T08:12:15.000Z"}],["meta",{"property":"article:tag","content":"微信小程序"}],["meta",{"property":"article:tag","content":"Web"}],["meta",{"property":"article:published_time","content":"2024-05-06T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-11-01T08:12:15.000Z"}]]},"git":{"createdTime":1761984735000,"updatedTime":1761984735000,"contributors":[{"name":"Garlen","username":"Garlen","email":"649975243@qq.com","commits":1,"url":"https://github.com/Garlen"}]},"readingTime":{"minutes":1.87,"words":560},"filePathRelative":"posts/Content-Disposition.md","excerpt":"<h2>记录WX小程序打开H5附件pdf下载链接的问题</h2>\\n<p><strong>现象</strong> ：<br>\\n小程序复用H5，打开下载链接的web-view，内容为一片乱码</p>\\n<p><strong>原因：</strong></p>\\n<p>在web端，后端接口提供的附件下载链接中，一般配置好了文件响应的Content-type指定了文件的类型。这里点击链接后，分了两种场景。</p>\\n<ul>\\n<li>浏览打开新标签页，并下载。</li>\\n<li>浏览打开新标签页，并在线预览。</li>\\n</ul>\\n<p>通过查看响应配置可知:</p>\\n<p>第一种下载的情况，可以看到</p>"}');export{c as comp,m as data};
