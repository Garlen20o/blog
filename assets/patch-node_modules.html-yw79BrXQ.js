import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,e,o as n}from"./app-Dvgq7Lzg.js";const t={};function p(l,s){return n(),a("div",null,[...s[0]||(s[0]=[e(`<h3 id="背景" tabindex="-1"><a class="header-anchor" href="#背景"><span>背景：</span></a></h3><p>开发时，当第三方库没有实现想要需求，或者想要样式。</p><p>这里一般能想到可以直接修改node_modules的源代码，但是这样不利于协作开发。</p><p>本质上，要修改依赖，是为了扩展现有的功能，填补需求，这就类似于打补丁了。</p><p>学习研究后，patch-package可以帮助解决这个问题。</p><h3 id="例子" tabindex="-1"><a class="header-anchor" href="#例子"><span>例子：</span></a></h3><p>以element-plus为例：修改<a href="https://element-plus.org/zh-CN/component/badge.html" target="_blank" rel="noopener noreferrer">badge</a>组件最大值的 &quot; + &quot;号*</p><p>安装vue3 + element-plus基本步骤就省略了。</p><ol><li><p>安装 npm i patch-package</p></li><li><p>在 package.json ; script中加上这个脚本命令<br> 附：“scripts”属性中的脚本</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-json"><span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  &quot;scripts&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    &quot;postinstall&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;patch-package&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  },</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>在node_modules修改源码</p><p><strong>重要</strong>:首先确认我这个vue + vite 工程 是 &quot;type&quot;: &quot;module&quot;;ESM , 所以修改的是\\node_modules\\element-plus\\es\\components\\badge才对，修改lib不生效，lib使用的是CommonJS .</p></li><li><p>npx patch-package <code>&lt;package-name&gt;</code></p><p>执行命令生成 patch-package补丁文件： npx patch-package element-plus</p></li><li><p>加入到版本管理就可以协作开发了。</p></li></ol><p><strong>以下就是生成的补丁文件：</strong></p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-js"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">diff</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> --</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">git</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> a</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">node_modules</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">element</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">plus</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">es</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">components</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">badge</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">src</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">badge2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">mjs</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> b</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">node_modules</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">element</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">plus</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">es</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">components</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">badge</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">src</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">badge2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">mjs</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">index</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> f4ca28e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">..</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">e86b811</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 100644</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">---</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> a</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">node_modules</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">element</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">plus</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">es</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">components</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">badge</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">src</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">badge2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">mjs</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">+++</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> b</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">node_modules</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">element</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">plus</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">es</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">components</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">badge</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">src</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">badge2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">mjs</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@@ </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">21</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">7</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">21</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">7</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> @@ </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> _sfc_main</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> /* @__PURE__ */</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> defineComponent</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">         return </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">       if (isNumber(props.value) &amp;&amp; isNumber(props.max)) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">         if (props.max &lt; props.value) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">-          return </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">\`</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">props</span><span style="--shiki-light:#50A14F;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">max</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">+\`</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">+          return </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">\`</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">props</span><span style="--shiki-light:#50A14F;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">max</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">...\`</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">         }</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">         return props.value === 0 &amp;&amp; !props.showZero ? </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;"> :</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">props</span><span style="--shiki-light:#50A14F;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">\`</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">       }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Tips：修改完源码后，重启服务可能还是不生效。看看构建工具的缓存的问题，vite可以看看删除 node_modules下的 .vite 文件。或者删除node_modules，重新安装依赖。</p><h4 id="附" tabindex="-1"><a class="header-anchor" href="#附"><span>附：</span></a></h4><p>npm 支持运行package.json里“scripts”属性中的脚本，包括：</p><ul><li><code>prepublish</code>：在<code>npm publish</code>命令之前运行（也会在不带参数的<code>npm install</code>命令前运行，详情在下段描述）</li><li><code>prepare</code>: 在两种情况前运行，一是<code>npm publish</code>命令前，二是不带参数的<code>npm install</code>命令；它会在<code>prepublish</code>之后、<code>prepublishOnly</code>之前执行</li><li><code>prepublishOnly</code>: 在<code>npm publish</code>命令前执行</li><li><code>publish,postpublish</code>： 在<code>npm publish</code>命令后执行</li><li><code>preinstall</code>: 在<code>npm install</code>命令前执行</li><li><code>install,postinstall</code>： 在<code>npm install</code>命令后执行</li><li><code>preuninstall，uninstall</code>: 在<code>npm uninstall</code>命令前执行</li><li><code>postuninstall</code> ： 在<code>npm uninstall</code>命令后执行</li><li><code>preversion</code>：在改变包的version前执行</li><li><code>version</code>： 在改变包的version后，但提交之前执行</li><li><code>postversion</code>： 在提交version变更后执行</li><li><code>pretest， test， posttest</code>： 伴随<code>npm test</code>命令</li><li><code>prestop， stop， poststop</code>： 伴随<code>npm stop</code>命令</li><li><code>restart, start, poststart</code>: 伴随 <code>npm start</code>命令</li><li><code>pre restart， restart， poststart</code>： 伴随 <code>npm restart</code>命令。提示：假如scripts里没有写restart命令，npm默认会运行start、stop</li><li><code>preshrinkwrap, shrinkwrap, postshrinkwrap</code>: 伴随 <code>npm shrinkwrap</code> 命令（用于固定依赖包版本）</li></ul>`,15)])])}const d=i(t,[["render",p]]),r=JSON.parse('{"path":"/posts/patch-node_modules.html","title":"patch-package修改node_modules中依赖的源码","lang":"zh-CN","frontmatter":{"title":"patch-package修改node_modules中依赖的源码","description":"patch-package修改node_modules中依赖的源码（避坑）","date":"2024-08-13T00:00:00.000Z","lastUpdated":false,"tags":["Npm"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"patch-package修改node_modules中依赖的源码\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2024-08-13T00:00:00.000Z\\",\\"dateModified\\":\\"2025-11-01T08:12:15.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Garlen\\",\\"url\\":\\"https://garlen20o.github.io/blog/\\"}]}"],["meta",{"property":"og:url","content":"https://garlen20o.github.io/blog/posts/patch-node_modules.html"}],["meta",{"property":"og:site_name","content":"Garlen"}],["meta",{"property":"og:title","content":"patch-package修改node_modules中依赖的源码"}],["meta",{"property":"og:description","content":"patch-package修改node_modules中依赖的源码（避坑）"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-11-01T08:12:15.000Z"}],["meta",{"property":"article:tag","content":"Npm"}],["meta",{"property":"article:published_time","content":"2024-08-13T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-11-01T08:12:15.000Z"}]]},"git":{"createdTime":1761984735000,"updatedTime":1761984735000,"contributors":[{"name":"Garlen","username":"Garlen","email":"649975243@qq.com","commits":1,"url":"https://github.com/Garlen"}]},"readingTime":{"minutes":2.19,"words":656},"filePathRelative":"posts/patch-node_modules.md","excerpt":"<h3>背景：</h3>\\n<p>开发时，当第三方库没有实现想要需求，或者想要样式。</p>\\n<p>这里一般能想到可以直接修改node_modules的源代码，但是这样不利于协作开发。</p>\\n<p>本质上，要修改依赖，是为了扩展现有的功能，填补需求，这就类似于打补丁了。</p>\\n<p>学习研究后，patch-package可以帮助解决这个问题。</p>\\n<h3>例子：</h3>\\n<p>以element-plus为例：修改<a href=\\"https://element-plus.org/zh-CN/component/badge.html\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">badge</a>组件最大值的 \\" + \\"号*</p>"}');export{d as comp,r as data};
